import collections
try:
    from collections import abc
    collections.MutableMapping = abc.MutableMapping
    collections.Mapping = abc.Mapping
except:
    pass

import requests
import ssl
from requests.adapters import HTTPAdapter
from requests.packages.urllib3.poolmanager import PoolManager


class SSLAdapter(HTTPAdapter):
    def __init__(self, ssl_version=None):
        self.ssl_version = ssl_version

        super(SSLAdapter, self).__init__()

    def init_poolmanager(self, connections, maxsize, block=False):
        self.poolmanager = PoolManager(num_pools=connections,
                                       maxsize=maxsize,
                                       block=block,
                                       ssl_version=self.ssl_version)


if __name__ == "__main__":
    session = requests.session()
    adapter = SSLAdapter(ssl.PROTOCOL_SSLv2)
    session.mount("https://", adapter)

    try:
        r = session.request('GET', 'https://127.0.0.1:8443/')
        print(r)
    except Exception as exception:
        print(exception)
